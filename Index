<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Web App</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    /* Custom scrollbar for dark mode */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-track {
      background-color: #1f2937;
    }

    /* Arrow icons for price change */
    .arrow-up::before {
      content: '▲';
      margin-right: 0.25rem;
      color: #34d399; /* green */
    }
    .arrow-down::before {
      content: '▼';
      margin-right: 0.25rem;
      color: #ef4444; /* red */
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div id="root" class="p-4"></div>
  <script type="text/babel">

    const {useState, useEffect} = React;

    // Utility for Thai date with Buddhist year
    function formatThaiDate(date) {
      const days = ['อาทิตย์','จันทร์','อังคาร','พุธ','พฤหัสบดี','ศุกร์','เสาร์'];
      const months = ['ม.ค.','ก.พ.','มี.ค.','เม.ย.','พ.ค.','มิ.ย.','ก.ค.','ส.ค.','ก.ย.','ต.ค.','พ.ย.','ธ.ค.'];
      const dayName = days[date.getDay()];
      const day = date.getDate();
      const month = months[date.getMonth()];
      const year = date.getFullYear() + 543; // Buddhist year
      return `วัน${dayName} ที่ ${day} ${month} ${year}`;
    }

    // Random daily horoscope messages
    const horoscopes = [
      "วันนี้เป็นวันที่เหมาะแก่การเริ่มต้นสิ่งใหม่ๆ",
      "ควรระวังเรื่องสุขภาพและการเดินทาง",
      "จะมีโอกาสได้รับข่าวดีจากคนไกล",
      "ระวังเรื่องการเงิน อย่าลงทุนโดยขาดการวางแผน",
      "ความรักสดใส มีโอกาสพบคนถูกใจ",
      "วันนี้เหมาะกับการทำงานร่วมกับทีม",
      "จงตั้งใจฟังและเรียนรู้จากคำแนะนำของผู้อื่น",
      "มีโอกาสสำเร็จในสิ่งที่ตั้งใจไว้",
      "วันนี้อาจมีเรื่องกังวลใจ ควรพักผ่อนให้เพียงพอ",
      "ความคิดสร้างสรรค์จะนำพาความสำเร็จ"
    ];

    // Components

    // Digital clock real-time
    function Clock() {
      const [time, setTime] = useState(new Date());
      useEffect(() => {
        const id = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(id);
      }, []);
      const timeString = time.toLocaleTimeString('th-TH');
      return (
        <div className="text-4xl font-mono text-center mb-4 select-none">{timeString}</div>
      );
    }

    // Thai calendar date real-time
    function ThaiCalendar() {
      const [date, setDate] = useState(new Date());
      useEffect(() => {
        const id = setInterval(() => setDate(new Date()), 60000);
        return () => clearInterval(id);
      }, []);
      return (
        <div className="text-xl font-semibold text-center mb-3 select-none">{formatThaiDate(date)}</div>
      );
    }

    // Daily horoscope (random daily)
    function DailyHoroscope() {
      // Determine a fixed "random" index by date
      const todayString = new Date().toISOString().slice(0,10); // YYYY-MM-DD
      let hash = 0;
      for(let i=0; i<todayString.length; i++) hash += todayString.charCodeAt(i);
      const index = hash % horoscopes.length;
      return (
        <div className="bg-gray-800 p-3 rounded-md text-center mb-5 select-none shadow-md">
          <div className="font-bold mb-1">ดวงประจำวัน</div>
          <p className="italic">{horoscopes[index]}</p>
        </div>
      );
    }

    // Price item with color and arrow
    function PriceItem({name, price, prevPrice, unit}) {
      const up = price > prevPrice;
      const down = price < prevPrice;
      const colorClass = up ? "text-green-400" : down ? "text-red-500" : "text-gray-400";
      const arrowClass = up ? "arrow-up" : down ? "arrow-down" : "";
      const formattedPrice = (typeof price === 'number') ? price.toLocaleString(undefined, {minimumFractionDigits: 2,maximumFractionDigits: 2}) : price;
      return (
        <div className={`flex justify-between items-center ${colorClass} ${arrowClass} select-none`}>
          <div>{name}{unit ? ` (${unit})` : ''}</div>
          <div>{formattedPrice}</div>
        </div>
      );
    }

    // Fetch API helper with error catch
    async function fetchJson(url) {
      try {
        const res = await fetch(url);
        if(!res.ok) throw new Error('Network response was not ok');
        return await res.json();
      } catch(e) {
        return null;
      }
    }

    // Prices dashboard
    function Prices({userTickers}) {
      const [bitcoinPrice, setBitcoinPrice] = useState(null);
      const [prevBitcoinPrice, setPrevBitcoinPrice] = useState(null);
      const [goldUsd, setGoldUsd] = useState(null);
      const [prevGoldUsd, setPrevGoldUsd] = useState(null);
      const [thaiGold, setThaiGold] = useState(null);
      const [prevThaiGold, setPrevThaiGold] = useState(null);
      const [sp500, setSp500] = useState(null);
      const [prevSp500, setPrevSp500] = useState(null);
      const [stocks, setStocks] = useState({});
      const [prevStocks, setPrevStocks] = useState({});

      // Update every 3 minutes (180000 ms)
      useEffect(() => {
        async function updatePrices() {
          // Bitcoin price from CoinGecko
          const btcData = await fetchJson(`https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd`);
          if(btcData && btcData.bitcoin && btcData.bitcoin.usd !== undefined) {
            setPrevBitcoinPrice(bitcoinPrice);
            setBitcoinPrice(btcData.bitcoin.usd);
          }

          // Gold price USD/oz from Metals-API (free plan limited, use demo endpoint)
          // Using GoldAPI is an alternative but Metals-API uses API key, here replaced by public demo endpoint for free example
          // We'll use Metals-API demo endpoint for gold USD price (approximate)
          // This is a public demo endpoint from Metals-API document: https://metals-api.com/documentation
          // If it stops working, user must replace with own API key or another free API.
          const metalsData = await fetchJson(`https://metals-api.com/api/latest?access_key=demo&base=USD&symbols=XAU`);
          if(metalsData && metalsData.rates && metalsData.rates.XAU !== undefined) {
            // metalsData.rates.XAU is amount of gold per 1 USD, so invert it to USD per XAU
            const priceUsdPerOz = 1 / metalsData.rates.XAU;
            setPrevGoldUsd(goldUsd);
            setGoldUsd(priceUsdPerOz);
          }

          // Thai gold price from สมาคมค้าทองคำไทย API (free public)
          // Using https://api.chnwt.dev/latest to get latest thai gold prices
          const thaiGoldData = await fetchJson("https://api.chnwt.dev/latest");
          if(thaiGoldData && thaiGoldData.rates && thaiGoldData.rates['96.5'] && thaiGoldData.rates['96.5'].buy !== undefined) {
            // Example: buy price for 96.5% gold (บาท/สลึง)
            const goldPrice = thaiGoldData.rates['96.5'].buy;
            setPrevThaiGold(thaiGold);
            setThaiGold(goldPrice);
          }

          // S&P 500 price from Yahoo Finance (symbol ^GSPC)
          const spData = await fetchJson(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=%5EGSPC`);
          if(spData && spData.quoteResponse && spData.quoteResponse.result && spData.quoteResponse.result.length > 0) {
            const spPrice = spData.quoteResponse.result[0].regularMarketPrice;
            setPrevSp500(sp500);
            setSp500(spPrice);
          }

          // Stocks user tickers
          if(userTickers.length > 0) {
            const tickersStr = userTickers.join(',');
            const stockData = await fetchJson(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${tickersStr}`);
            if(stockData && stockData.quoteResponse && stockData.quoteResponse.result) {
              const newStocks = {};
              stockData.quoteResponse.result.forEach(stock => {
                newStocks[stock.symbol] = {
                  price: stock.regularMarketPrice,
                  prevClose: stock.regularMarketPreviousClose
                };
              });
              setPrevStocks(stocks);
              setStocks(newStocks);
            }
          }
        }
        updatePrices();
        const intervalId = setInterval(updatePrices, 180000); // 3 minutes
        return () => clearInterval(intervalId);
      }, [userTickers, bitcoinPrice, goldUsd, thaiGold, sp500, stocks]);

      // Render
      return (
        <div className="bg-gray-800 rounded-md p-4 mb-5 shadow-md">
          <h2 className="text-xl font-bold border-b border-gray-600 pb-2 mb-3 select-none">ราคาสินทรัพย์</h2>
          {/* Bitcoin */}
          <PriceItem name="Bitcoin (BTC)" price={bitcoinPrice} prevPrice={prevBitcoinPrice} unit="USD" />
          {/* Gold USD/oz */}
          <PriceItem name="ทองคำ (USD/oz)" price={goldUsd} prevPrice={prevGoldUsd} />
          {/* Thai Gold */}
          <PriceItem name="ทองคำไทย (บาท/สลึง)" price={thaiGold} prevPrice={prevThaiGold} />
          {/* S&P 500 */}
          <PriceItem name="S&P 500" price={sp500} prevPrice={prevSp500} />
          {/* User stocks */}
          {userTickers.length > 0 && <div className="mt-3 font-semibold select-none">หุ้นที่ติดตาม</div>}
          {userTickers.map(ticker => {
            const stock = stocks[ticker];
            if(!stock) return <div key={ticker} className="text-gray-500 select-none">{ticker}: กำลังโหลด...</div>;
            return (
              <PriceItem
                key={ticker}
                name={ticker}
                price={stock.price}
                prevPrice={stock.prevClose}
              />
            );
          })}
        </div>
      );
    }

    // Short news daily (static example)
    // In real app, could fetch from news API; here just static demo
    const dailyNewsSample = [
      "ตลาดหุ้นปรับตัวขึ้นรับข่าวเศรษฐกิจบวก",
      "Bitcoin ปรับตัวขึ้นถึง 5% ในวันนี้",
      "ราคาทองคำทั่วโลกปรับตัวลดลงเล็กน้อย",
      "บริษัทเทคโนโลยีเปิดตัวผลิตภัณฑ์ใหม่",
      "นักลงทุนจับตาดูผลประกอบการไตรมาสหน้า"
    ];

    function DailyNews() {
      return (
        <div className="bg-gray-800 rounded-md p-4 shadow-md">
          <h2 className="text-xl font-bold border-b border-gray-600 pb-2 mb-3 select-none">ข่าวสั้น ๆ ประจำวัน</h2>
          <ul className="list-disc list-inside space-y-1">
            {dailyNewsSample.map((news, i) => (
              <li key={i} className="select-text">{news}</li>
            ))}
          </ul>
        </div>
      );
    }

    // Add ticker form
    function AddTickerForm({onAdd}) {
      const [input, setInput] = useState('');
      const handleSubmit = (e) => {
        e.preventDefault();
        const t = input.trim().toUpperCase();
        if(t) {
          onAdd(t);
          setInput('');
        }
      }
      return (
        <form onSubmit={handleSubmit} className="mb-5 select-none">
          <label className="font-semibold mr-2">เพิ่มหุ้น (Ticker): </label>
          <input
            className="p-1 rounded text-gray-900"
            type="text"
            value={input}
            maxLength={10}
            onChange={(e) => setInput(e.target.value)}
            placeholder="เช่น AAPL"
            aria-label="Stock ticker"
          />
          <button type="submit" className="ml-2 px-3 py-1 bg-green-600 rounded hover:bg-green-700">เพิ่ม</button>
        </form>
      );
    }

    // Main App component
    function App() {
      const [userTickers, setUserTickers] = useState(['AAPL', 'GOOGL', 'TSLA']);
      const [orientation, setOrientation] = useState('portrait');  // portrait or landscape

      // Detect orientation (manual toggle)
      function toggleOrientation() {
        setOrientation(orientation === 'portrait' ? 'landscape' : 'portrait');
      }

      // Layout style based on orientation
      const containerClasses = orientation === 'portrait' ? "flex flex-col max-w-xl mx-auto" : "grid grid-cols-3 gap-4 max-w-7xl mx-auto";

      return (
        <div>
          <div className="flex justify-between items-center mb-4 select-none">
            <h1 className="text-2xl font-bold">Dashboard Web App</h1>
            <button onClick={toggleOrientation} className="px-3 py-1 bg-indigo-600 rounded hover:bg-indigo-700">
              สลับโหมด {orientation === 'portrait' ? 'แนวนอน' : 'แนวตั้ง'}
            </button>
          </div>
          <div className={containerClasses}>
            <div className="p-2">
              <Clock />
              <ThaiCalendar />
              <DailyHoroscope />
              <AddTickerForm onAdd={(ticker) => {
                if(!userTickers.includes(ticker)) setUserTickers([...userTickers, ticker]);
              }} />
              <Prices userTickers={userTickers} />
            </div>
            <div className="p-2 col-span-2">
              <DailyNews />
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
